<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ゆらぎ時計</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #111;
      color: white;
      font-size: 15rem;
      padding-top: 20vh;
    }
  </style>
</head>
<body>
  <div id="clock">--:--:--</div>

  <script>
    const clock = document.getElementById('clock');
    let customHours = null;
    let customMinutes = null;
    let customSeconds = 0;
    let currentMinuteLength = 60;
    let mode = 'sync'; // 'sync' or 'drift'

    function updateClockDisplay(h, m, s) {
      const hh = String(h).padStart(2, '0');
      const mm = String(m).padStart(2, '0');
      const ss = String(s).padStart(2, '0');
      clock.textContent = `${hh}:${mm}:${ss}`;
    }

    function startDriftClock() {
      const now = new Date();
      customHours = now.getHours();
      customMinutes = now.getMinutes();
      customSeconds = now.getSeconds();
      mode = 'drift';

      updateClockDisplay(customHours, customMinutes, customSeconds);
      currentMinuteLength = 45 + Math.floor(Math.random() * 31); // 45〜75秒

      const interval = setInterval(() => {
        if (mode === 'sync') {
          clearInterval(interval);
          startClock(); // 同期モードに戻る
          return;
        }

        customSeconds++;

        if (customSeconds >= currentMinuteLength) {
          customSeconds = 0;
          customMinutes++;
          currentMinuteLength = 45 + Math.floor(Math.random() * 31); // 次の分の長さ

          if (customMinutes >= 60) {
            customMinutes = 0;
            customHours++;

            if (customHours >= 24) {
              customHours = 0;
            }

            mode = 'sync'; // ちょうど1時間経ったので同期に戻す
            return;
          }
        }

        updateClockDisplay(customHours, customMinutes, Math.floor(customSeconds));
      }, 1000); // 1秒ごとにカウント（見た目はゆらぐ）
    }

    function startClock() {
      mode = 'sync';

      function syncLoop() {
        const now = new Date();
        const h = now.getHours();
        const m = now.getMinutes();
        const s = now.getSeconds();

        updateClockDisplay(h, m, s);

        if (m !== 0 || s !== 0) {
          // 00分00秒以外ならドリフトモードへ
          startDriftClock();
        }
      }

      syncLoop();
      const syncInterval = setInterval(() => {
        if (mode === 'drift') {
          clearInterval(syncInterval);
        } else {
          syncLoop();
        }
      }, 1000);
    }

    startClock();
  </script>
</body>
</html>
